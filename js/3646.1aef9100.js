"use strict";(self["webpackChunkresep_bunda"]=self["webpackChunkresep_bunda"]||[]).push([[3646],{3646:(e,n,u)=>{u.r(n),u.d(n,{default:()=>_});var a=u(6347),t=u(124),r=u(3144),l=u(8534),o=(u(7327),u(1539),u(6699),u(2023),u(1249),u(2564),u(9575),u(2472),u(8675),u(2990),u(8927),u(3105),u(5035),u(4345),u(7174),u(3408),u(2958),u(2846),u(4731),u(7209),u(6319),u(8867),u(7789),u(3739),u(9368),u(4483),u(2056),u(3462),u(678),u(7462),u(3824),u(5021),u(2974),u(1439),u(7585),u(5016),u(5315),u(6252)),i=u(2262),s=u(3577),c=u(7208),f=u(316),d=u(6100),m=u(5856),p=u(4105),k={class:"table-container"},w=(0,o._)("h2",null,"Daftar Pengguna",-1),v={class:"table-wrapper"},g=(0,o._)("thead",null,[(0,o._)("tr",null,[(0,o._)("th",null,"Nama Lengkap"),(0,o._)("th",null,"Username"),(0,o._)("th",null,"Email"),(0,o._)("th",null,"Role"),(0,o._)("th",null,"QR Code"),(0,o._)("th",null,"Status"),(0,o._)("th",null,"Aksi")])],-1);const U={__name:"HalamanPengguna",setup:function(e){var n=(0,f.v0)(m.H),u=(0,d.ad)(m.H),U=(0,i.iH)([]),h=(0,i.iH)(""),_=(0,i.iH)({isOpen:!1,message:"",duration:2e3,color:"success"}),S=(0,i.iH)(!1),W=(0,i.iH)({}),b=(0,i.iH)(""),x=(0,o.Fl)((function(){return U.value.filter((function(e){return e.fullName.toLowerCase().includes(h.value.toLowerCase())}))})),C=function(){var e=(0,l.Z)((0,t.Z)().mark((function e(){var n,a;return(0,t.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=(0,d.IO)((0,d.hJ)(u,"users"),(0,d.ar)("fullName",">=",h.value),(0,d.ar)("fullName","<=",h.value+"ï£¿")),e.prev=1,e.next=4,(0,d.PL)(n);case 4:a=e.sent,U.value=a.docs.map((function(e){return(0,r.Z)({id:e.id},e.data())})),console.log("Data pengguna berhasil diambil:",U.value),e.next=13;break;case 9:e.prev=9,e.t0=e["catch"](1),console.error("Error fetching user data:",e.t0),N("Terjadi kesalahan saat mengambil data pengguna","danger");case 13:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(){return e.apply(this,arguments)}}(),y=function(){C()},Z=function(e){setTimeout((function(){C(),e.target.complete()}),2e3)},N=function(e,n){_.value={isOpen:!0,message:e,duration:2e3,color:n}},P=function(){var e=U.value.map((function(e){return{fullName:e.fullName,username:e.username,email:e.email,role:e.role,qrCode:e.qrCode,status:e.status}})),n=p.P6.json_to_sheet(e),u=p.P6.book_new();p.P6.book_append_sheet(u,n,"Pengguna"),p.NC(u,"daftar_pengguna.xlsx"),N("Data pengguna berhasil diekspor","success")},V=function(e){W.value=(0,r.Z)({},e),S.value=!0},j=function(){var e=(0,l.Z)((0,t.Z)().mark((function e(){var a,r;return(0,t.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,a=(0,d.JU)(u,"users",W.value.id),e.next=4,(0,d.r7)(a,{fullName:W.value.fullName,username:W.value.username,email:W.value.email,role:W.value.role});case 4:if(!b.value){e.next=11;break}return e.next=7,n.getUser(W.value.id);case 7:return r=e.sent,e.next=10,(0,f.gQ)(r,b.value);case 10:b.value="";case 11:N("Data pengguna berhasil diperbarui","success"),C(),I(),e.next=20;break;case 16:e.prev=16,e.t0=e["catch"](0),console.error("Error updating user data:",e.t0),N("Terjadi kesalahan saat memperbarui data pengguna","danger");case 20:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(){return e.apply(this,arguments)}}(),E=function(){var e=(0,l.Z)((0,t.Z)().mark((function e(u){return(0,t.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,f.LS)(n,u);case 3:N("Email untuk reset password telah dikirim","success"),e.next=10;break;case 6:e.prev=6,e.t0=e["catch"](0),console.error("Error sending password reset email:",e.t0),N("Terjadi kesalahan saat mengirim email reset password","danger");case 10:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(n){return e.apply(this,arguments)}}(),G=function(){var e=(0,l.Z)((0,t.Z)().mark((function e(n){var a;return(0,t.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,a="aktif"===n.status?"nonaktif":"aktif",e.next=4,(0,d.r7)((0,d.JU)(u,"users",n.id),{status:a});case 4:N("Status pengguna berhasil diubah menjadi ".concat(a),"success"),C(),e.next=12;break;case 8:e.prev=8,e.t0=e["catch"](0),console.error("Error updating user status:",e.t0),N("Terjadi kesalahan saat mengubah status pengguna","danger");case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(n){return e.apply(this,arguments)}}(),H=function(){var e=(0,l.Z)((0,t.Z)().mark((function e(n){return(0,t.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,d.oe)((0,d.JU)(u,"users",n));case 3:N("Pengguna berhasil dihapus","success"),C(),e.next=11;break;case 7:e.prev=7,e.t0=e["catch"](0),console.error("Error deleting user:",e.t0),N("Terjadi kesalahan saat menghapus pengguna","danger");case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(n){return e.apply(this,arguments)}}(),I=function(){S.value=!1,W.value={},b.value=""},Y=(0,i.iH)(null),D=function(e){Y.value=e.target.files[0]},q=function(){var e=(0,l.Z)((0,t.Z)().mark((function e(){var r;return(0,t.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(Y.value){e.next=3;break}return N("Silakan pilih file Excel terlebih dahulu","danger"),e.abrupt("return");case 3:r=new FileReader,r.onload=function(){var e=(0,l.Z)((0,t.Z)().mark((function e(r){var l,o,i,s,c,m,k,w,v,g;return(0,t.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:l=new Uint8Array(r.target.result),o=p.ij(l,{type:"array"}),i=o.SheetNames[0],s=o.Sheets[i],c=p.P6.sheet_to_json(s),m=(0,a.Z)(c),e.prev=6,m.s();case 8:if((k=m.n()).done){e.next=26;break}return w=k.value,e.prev=10,e.next=13,(0,f.Xb)(n,w.email,w.password);case 13:return v=e.sent,g=v.user.uid,e.next=17,(0,d.pl)((0,d.JU)(u,"users",g),{email:w.email,fullName:w.fullName,kelas:w.kelas,nisn:w.nisn||"",profilePicture:w.profilePicture,role:w.role,schoolName:w.schoolName,status:w.status,username:w.username});case 17:N("Pengguna ".concat(w.fullName," berhasil ditambahkan"),"success"),e.next=24;break;case 20:e.prev=20,e.t0=e["catch"](10),console.error("Error adding user:",e.t0),N("Gagal menambahkan pengguna: ".concat(e.t0.message),"danger");case 24:e.next=8;break;case 26:e.next=31;break;case 28:e.prev=28,e.t1=e["catch"](6),m.e(e.t1);case 31:return e.prev=31,m.f(),e.finish(31);case 34:C();case 35:case"end":return e.stop()}}),e,null,[[6,28,31,34],[10,20]])})));return function(n){return e.apply(this,arguments)}}(),r.readAsArrayBuffer(Y.value);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,o.bv)((function(){(0,f.Aj)(n,(function(e){e?C():(console.error("User not authenticated"),N("Pengguna tidak terautentikasi","danger"))}))})),function(e,n){return(0,o.wg)(),(0,o.j4)((0,i.SU)(c._i),null,{default:(0,o.w5)((function(){return[(0,o.Wm)((0,i.SU)(c.Gu),{mode:"ios"},{default:(0,o.w5)((function(){return[(0,o.Wm)((0,i.SU)(c.sr),null,{default:(0,o.w5)((function(){return[(0,o.Wm)((0,i.SU)(c.wd),null,{default:(0,o.w5)((function(){return[(0,o.Uk)("Pengguna")]})),_:1}),(0,o.Wm)((0,i.SU)(c.oU),{slot:"start","default-href":"/"})]})),_:1})]})),_:1}),(0,o.Wm)((0,i.SU)(c.W2),{fullscreen:!0},{default:(0,o.w5)((function(){return[(0,o.Wm)((0,i.SU)(c.nJ),{slot:"fixed",onIonRefresh:n[0]||(n[0]=function(e){return Z(e)})},{default:(0,o.w5)((function(){return[(0,o.Wm)((0,i.SU)(c.Wo))]})),_:1}),(0,o.Wm)((0,i.SU)(c.W2),{class:"ion-padding"},{default:(0,o.w5)((function(){return[(0,o.Wm)((0,i.SU)(c.Ie),null,{default:(0,o.w5)((function(){return[(0,o.Wm)((0,i.SU)(c.Q$),null,{default:(0,o.w5)((function(){return[(0,o.Uk)("Cari Pengguna")]})),_:1}),(0,o.Wm)((0,i.SU)(c.pK),{modelValue:h.value,"onUpdate:modelValue":n[1]||(n[1]=function(e){return h.value=e}),placeholder:"Masukkan nama pengguna"},null,8,["modelValue"])]})),_:1}),(0,o.Wm)((0,i.SU)(c.YG),{style:{color:"white"},expand:"block",onClick:y},{default:(0,o.w5)((function(){return[(0,o.Uk)("Cari")]})),_:1}),(0,o.Wm)((0,i.SU)(c.Ie),null,{default:(0,o.w5)((function(){return[(0,o._)("input",{type:"file",accept:".xlsx, .xls",onChange:D},null,32)]})),_:1}),(0,o.Wm)((0,i.SU)(c.YG),{style:{color:"white"},expand:"block",onClick:q},{default:(0,o.w5)((function(){return[(0,o.Uk)(" Import Pengguna dari Excel ")]})),_:1}),(0,o._)("div",k,[(0,o.Wm)((0,i.SU)(c.jY),null,{default:(0,o.w5)((function(){return[(0,o.Wm)((0,i.SU)(c.Nd),null,{default:(0,o.w5)((function(){return[(0,o.Wm)((0,i.SU)(c.wI),null,{default:(0,o.w5)((function(){return[w,(0,o._)("div",v,[(0,o._)("table",null,[g,(0,o._)("tbody",null,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(x.value,(function(e){return(0,o.wg)(),(0,o.iD)("tr",{key:e.id},[(0,o._)("td",null,(0,s.zw)(e.fullName),1),(0,o._)("td",null,(0,s.zw)(e.username),1),(0,o._)("td",null,(0,s.zw)(e.email),1),(0,o._)("td",null,(0,s.zw)(e.role),1),(0,o._)("td",null,(0,s.zw)(e.qrCode),1),(0,o._)("td",null,(0,s.zw)(e.status),1),(0,o._)("td",null,[(0,o.Wm)((0,i.SU)(c.YG),{style:{color:"white"},onClick:function(n){return V(e)}},{default:(0,o.w5)((function(){return[(0,o.Uk)("Edit")]})),_:2},1032,["onClick"]),(0,o.Wm)((0,i.SU)(c.YG),{onClick:function(n){return G(e)},color:"aktif"===e.status?"danger":"success"},{default:(0,o.w5)((function(){return[(0,o.Uk)((0,s.zw)("aktif"===e.status?"Nonaktifkan":"Aktifkan"),1)]})),_:2},1032,["onClick","color"]),(0,o.Wm)((0,i.SU)(c.YG),{style:{color:"white"},onClick:function(n){return E(e.email)}},{default:(0,o.w5)((function(){return[(0,o.Uk)("Reset Password")]})),_:2},1032,["onClick"]),(0,o.Wm)((0,i.SU)(c.YG),{color:"danger",onClick:function(n){return H(e.id)}},{default:(0,o.w5)((function(){return[(0,o.Uk)("Hapus")]})),_:2},1032,["onClick"])])])})),128))])])])]})),_:1})]})),_:1})]})),_:1})]),(0,o.Wm)((0,i.SU)(c.YG),{style:{color:"white"},expand:"block",onClick:P},{default:(0,o.w5)((function(){return[(0,o.Uk)("Export ke Excel")]})),_:1})]})),_:1}),(0,o.Wm)((0,i.SU)(c.Px),{"is-open":_.value.isOpen,message:_.value.message,duration:_.value.duration,color:_.value.color,onDidDismiss:n[2]||(n[2]=function(){return _.value.isOpen=!1})},null,8,["is-open","message","duration","color"]),(0,o.Wm)((0,i.SU)(c.ki),{"is-open":S.value,onDidDismiss:I},{default:(0,o.w5)((function(){return[(0,o.Wm)((0,i.SU)(c.Gu),null,{default:(0,o.w5)((function(){return[(0,o.Wm)((0,i.SU)(c.sr),null,{default:(0,o.w5)((function(){return[(0,o.Wm)((0,i.SU)(c.wd),null,{default:(0,o.w5)((function(){return[(0,o.Uk)("Edit Pengguna")]})),_:1}),(0,o.Wm)((0,i.SU)(c.Sm),{slot:"end"},{default:(0,o.w5)((function(){return[(0,o.Wm)((0,i.SU)(c.YG),{onClick:I},{default:(0,o.w5)((function(){return[(0,o.Uk)("Close")]})),_:1})]})),_:1})]})),_:1})]})),_:1}),(0,o.Wm)((0,i.SU)(c.W2),null,{default:(0,o.w5)((function(){return[W.value?((0,o.wg)(),(0,o.j4)((0,i.SU)(c.Ie),{key:0},{default:(0,o.w5)((function(){return[(0,o.Wm)((0,i.SU)(c.Q$),null,{default:(0,o.w5)((function(){return[(0,o.Uk)("Nama Lengkap")]})),_:1}),(0,o.Wm)((0,i.SU)(c.pK),{modelValue:W.value.fullName,"onUpdate:modelValue":n[3]||(n[3]=function(e){return W.value.fullName=e})},null,8,["modelValue"])]})),_:1})):(0,o.kq)("",!0),W.value?((0,o.wg)(),(0,o.j4)((0,i.SU)(c.Ie),{key:1},{default:(0,o.w5)((function(){return[(0,o.Wm)((0,i.SU)(c.Q$),null,{default:(0,o.w5)((function(){return[(0,o.Uk)("Username")]})),_:1}),(0,o.Wm)((0,i.SU)(c.pK),{modelValue:W.value.username,"onUpdate:modelValue":n[4]||(n[4]=function(e){return W.value.username=e})},null,8,["modelValue"])]})),_:1})):(0,o.kq)("",!0),W.value?((0,o.wg)(),(0,o.j4)((0,i.SU)(c.Ie),{key:2},{default:(0,o.w5)((function(){return[(0,o.Wm)((0,i.SU)(c.Q$),null,{default:(0,o.w5)((function(){return[(0,o.Uk)("Email")]})),_:1}),(0,o.Wm)((0,i.SU)(c.pK),{modelValue:W.value.email,"onUpdate:modelValue":n[5]||(n[5]=function(e){return W.value.email=e})},null,8,["modelValue"])]})),_:1})):(0,o.kq)("",!0),W.value?((0,o.wg)(),(0,o.j4)((0,i.SU)(c.Ie),{key:3},{default:(0,o.w5)((function(){return[(0,o.Wm)((0,i.SU)(c.Q$),null,{default:(0,o.w5)((function(){return[(0,o.Uk)("Role")]})),_:1}),(0,o.Wm)((0,i.SU)(c.t9),{modelValue:W.value.role,"onUpdate:modelValue":n[6]||(n[6]=function(e){return W.value.role=e})},{default:(0,o.w5)((function(){return[(0,o.Wm)((0,i.SU)(c.n0),{value:"admin"},{default:(0,o.w5)((function(){return[(0,o.Uk)("Admin")]})),_:1}),(0,o.Wm)((0,i.SU)(c.n0),{value:"siswa"},{default:(0,o.w5)((function(){return[(0,o.Uk)("Siswa")]})),_:1}),(0,o.Wm)((0,i.SU)(c.n0),{value:"guru"},{default:(0,o.w5)((function(){return[(0,o.Uk)("Guru")]})),_:1})]})),_:1},8,["modelValue"])]})),_:1})):(0,o.kq)("",!0),W.value?((0,o.wg)(),(0,o.j4)((0,i.SU)(c.Ie),{key:4},{default:(0,o.w5)((function(){return[(0,o.Wm)((0,i.SU)(c.Q$),null,{default:(0,o.w5)((function(){return[(0,o.Uk)("Password Baru")]})),_:1}),(0,o.Wm)((0,i.SU)(c.pK),{modelValue:b.value,"onUpdate:modelValue":n[7]||(n[7]=function(e){return b.value=e}),type:"password"},null,8,["modelValue"])]})),_:1})):(0,o.kq)("",!0),(0,o.Wm)((0,i.SU)(c.YG),{expand:"block",onClick:j},{default:(0,o.w5)((function(){return[(0,o.Uk)("Simpan")]})),_:1})]})),_:1})]})),_:1},8,["is-open"])]})),_:1})]})),_:1})}}},h=U,_=h}}]);
//# sourceMappingURL=3646.1aef9100.js.map